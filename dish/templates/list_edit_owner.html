{% extends '_base.html' %}{% block title %}Edit List Info{% endblock %}{% block super-extra-head %}	{% load static %}	<link href="{% static 'dist/jquery/autocomplete/jquery-ui.min.css' %}" rel="stylesheet" >{% endblock %}{% block content %}<!--Modal-0 Processing --><div class="modal fade" id="modal_processing" tabindex="-1" role="dialog" aria-labelledby="modal_processingLabel" data-backdrop="static" data-keyboard="false">  <div class="modal-dialog" role="document">    <div class="modal-content">      <div class="modal-header">        <h1 class="modal-title" id="modal_processingLabel">Processing...</h1>      </div>      <div class="modal-body">		<div class="progress">			  <div class="progress-bar progress-bar-striped progress-bar-warning active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">			  </div>		</div>      </div>    </div>  </div></div><!--Modal-0 end --><!-- Modal-1 Add dish --><div class="modal fade" id="modal_adddish" tabindex="-1" role="dialog" aria-labelledby="modal_adddishLabel"><div class="modal-dialog" role="document"><div class="modal-content">	<div class="modal-header">		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>		<h1 style="margin-top:0px;">Search Dish</h1>		<input class="form-control ui-autocomplete-input" id="id_auto" name="auto" type="text" placeholder="type dish name here.." autocomplete="off"/>	</div>	<div class="modal-body row" id="modal_dish" style="display:none;">		<div class="col-sm-5">			<h2 id="modal_dishname" style="margin-top:0px;text-align:left;margin-bottom:0px;"></h2>			<p><b><i id="modal-othernames"></i></b> <i id="modal_cuisines"></i></p>			<p id="modal-dishdescription"></p>		</div>		<div class="col-sm-7">			<img id="modal-image" src="" class="img-rounded" width="300px" style="margin-bottom: 6px;"/>		</div>	</div>	<div class="modal-footer">		<div class="col-xs-6">			<div id="myAlert" class="alert alert-danger fade" role="alert" style="margin-bottom:0px;padding-top:10px;padding-bottom:10px;text-align:center;">			  <b>Dish already in the list!</b>			</div>		</div>		<div class="col-xs-6">			<a type="button" class="btn btn-custom btn-lg" onclick="processing();" href="" id="modal_select" style="visibility:hidden;">Add dish</a>			<button type="button" class="btn btn-default btn-lg" id="modal_cancel" data-dismiss="modal">Cancel</button>		</div>	</div></div></div></div><!-- Modal-1 END--><!-- Modal-2 Delete Dish --><div class="modal fade" id="modal_delete" tabindex="-1" role="dialog" aria-labelledby="modal_deleteLabel"><div class="modal-dialog" role="document"><div class="modal-content">	<div class="modal-header">		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>		<h1 style="margin-top:0px;">Delete Dish From List?</h1>	</div>	<div class="modal-body row" id="modal_dish">		<div class="col-sm-5">			<h2 id="modaldelete_dishname" style="margin-top:0px;text-align:left;margin-bottom:0px;"></h2>			<p><b><i id="modaldelete_othernames"></i></b> <i id="modaldelete_cuisines"></i></p>			<p id="modaldelete_description"></p>		</div>		<div class="col-sm-7">			<img id="modaldelete_image" src="" class="img-rounded" width="300px" style="margin-bottom: 6px;"/>		</div>	</div>	<div class="modal-footer" style="text-align:right;">		<a class="btn btn-custom btn-lg" onclick="processing();" href="" id="modaldelete_button">Delete dish</a>		<button type="button" class="btn btn-default btn-lg" id="modal_cancel" data-dismiss="modal">Cancel</button>	</div></div></div></div><!-- Modal-2 END--><!-- Modal-3 ADD COMMENT -->{# Modal Add comment to dish: #}<div class="modal fade" id="modalComment" tabindex="-1" role="dialog" aria-labelledby="modalCommentLabel" data-backdrop="static" data-keyboard="false">  <div class="modal-dialog">    <div class="modal-content">	<div class="modal-header">		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>		<h2 id="modalcomment_dishname" style="margin-top:0px;text-align:left;margin-bottom:0px;"></h2>	</div>      <div class="modal-body">		<form action="/list_dish_comment_update/" method="POST">			{% csrf_token %}			<div class="form-group">				<label for="comments" class="control-label">Comments:</label>				<textarea rows="10" class="form-control" name="comments" id="id_comments"></textarea>				<input type="text" class="form-control" name="id_listdish" id="id_list_dish" style="display:none;"/>			</div>			<div class="modal-footer">				<input id="save_comment" type="submit" class="btn btn-custom btn-lg" value="Save"/>				<button type="button" class="btn btn-default btn-lg" data-dismiss="modal">Cancel</button>			</div>		</form>	   </div>    </div>  </div></div><!-- Modal-3 END  --><h1>Edit List</h1><div class="well row">	{% if alert = 1 %}		<div class="alert alert-danger alert-dismissible" role="alert" style="margin:10px 10px;">		  <button type="button" class="close" data-dismiss="alert" aria-label="Close">			  <span aria-hidden="true">&times;</span>		  </button>		  The dish <b>"blanck"</b> doesn't exist. Try again or cancel.		</div>	{% endif %}		<form enctype='multipart/form-data' action="." method="POST">			{% csrf_token %}			{{ form.non_field_errors }}			<div class="fieldWrapper">				<label for="id_name">List title:</label>				{{ form.name }}				{{ form.name.errors }}			</div>			<div class="fieldWrapper">				<label for="id_description">Description:</label>				{{ form.description }}				{{ form.description.errors }}			</div>			<div class="fieldWrapper">				<label for="id_type">Type:</label>				{{ form.type }}				{{ form.type.errors }}			</div>			<div class="row" style="margin-top: 10px;">					<div class="col-xs-6">					<button class="btn btn-lg btn-custom btn-block" type="submit"/>Save</button>				</div>				<div class="col-xs-6">					<a class="btn btn-custom btn-lg btn-block" href="/list/{{list.urlname}}/">Back to List</a>				</div>			</div>		</form></div><br><div class="well" style="margin-bottom:0px;"><h2 style="margin-top:0px; margin-bottom:2px;">Dishes in List</h2><div style="text-align:center;">{% if total > 0 %}	<a class="btn btn-custom" href="{% url 'view_listindexedit' urlname=list.urlname%}" title="Change order of dishes">Change order</a>{% endif %}<a type="button" class="btn btn-custom" data-toggle="modal" data-target="#modal_adddish">Add Dish</a></div>{% if total > 0 %}<table class="table table-hover table-list table-white" width="100%" border="0" style="margin-bottom:0px;"><tbody>	{% for p in dishes %}	<tr>		<td style="padding-bottom:2px; vertical-align:top; text-align:left;" width="65%">			<a id="{{p.dish.id}}" name="delete_{{p.dish.id}}" class="btn btn-custom pull-right" title="Delete dish form list"><i class="fa fa-remove"></i></a>			<h2 style="margin-top:10px; display:inline-block; margin-bottom: 2px; text-align:left;">{{p.index}}.			<a id="dishname_{{p.dish.id}}" href="/dish/{{p.dish.urlname}}/" title="Go to Dish page">{{ p.dish.name|truncatechars:34 }}</a>			</h2>			<div id="{{p.dish.urlname}}" style="display:none;"></div>			{% if p.dish.othernames %}				<p style="display:inline-block; margin-bottom: 2px;"><b><i id="othernames_{{p.dish.id}}">{{p.dish.othernames}}</i></b></p>			{% endif %}			<p class="smallfont" style="margin-bottom: 2px;">			{% for c in p.dish.cuisines.all|slice:":4" %}			  (<a href="/cuisine/{{c.urlname}}/" title="Go to: {{c.name}}">{{c.name|truncatechars:18}}</a>)			{% endfor %} (Added by: <a href="/foodie/{{p.owner}}/" title="Go to: {{p.owner}}">{{p.owner|truncatechars:18}}</a>)<br>			</p>			  <div id="cuisines_{{p.dish.id}}" style="display:none;">				{% for c in p.dish.cuisines.all|slice:":4" %}					({{c.name|truncatechars:18}}) 				{% endfor %}			  </div>			<p id="description_{{p.dish.id}}">				{{p.dish.description|urlizetrunc:44|truncatewords:48}}			</p>			{# to get dish name: #}			<div id="dishnamecomment_{{p.index}}" style="display:none;">				{{p.dish.name}}			</div>			{# Comments #}			{% if p.description %}				<div class="well well-white" style="padding:5px;">				<!--<p style="margin-bottom:0px;">-->				<div id="small_{{p.index}}" style="display:block;">					<i>{{p.description|urlizetrunc:44|truncatewords:32|escape|linebreaks}}</i>				</div>				{% if p.description|wordcount > 32 %}					<div id="big_{{p.index}}" style="display:none;">					<i>{{p.description|urlizetrunc:44|escape|linebreaks}}</i>					</div>					<i><a class="btn btn-default" id="more_{{p.index}}" data-content="toggle-text">more</a></i>				{% endif %}					<p id="comment_whole_{{p.index}}" style="display:none;">						{{p.description}}					</p>				{% if user.id = list.owner.user.id %}					<a class="btn btn-default" id="comment_{{p.id}}" name="{{p.index}}"  title="Edit comment"><i class="fa fa-pencil" aria-hidden="true"></i></a>				{% endif %}				</div>			{% else %}				{% if user.id = list.owner.user.id %}				<div class="well well-white" style="padding:5px;">				<a class="btn btn-default" id="comment_{{p.id}}" name="{{p.index}}" title="Add comment"><i>Add comment...</i></a>				</div>				{% endif %}			{% endif %}		</td>		<td style="text-align: center;" width="35%">		{% if p.dish.photo_main %}		<a href="/photo/{{p.dish.favphoto.urlname}}" title="Go to photo page">			<img id="url_{{p.dish.id}}" src="{{p.dish.favphotomed}}" class="img-rounded"  alt="{{p.dish.name}}" width="100%">		</a>		{% else %}			<a href="/photonew/{{p.dish.id}}/" title="Upload photo for {{p.dish.name|truncatechars:24}}">				<img id="url_{{p.dish.id}}" src="/media/images/upload-med.jpg" class="img-rounded" width="100%">			</a>		{% endif %}		</td>	</tr>	{% endfor %}	</tbody>	</table><div style="text-align:center;">{% if total > 0 %}	<a class="btn btn-custom" href="{% url 'view_listindexedit' urlname=list.urlname%}" title="Change order of dishes">Change order</a>{% endif %}<a type="button" class="btn btn-custom" data-toggle="modal" data-target="#modal_adddish">Add Dish</a></div>{% else %}	<div class="well well-white" style="text-align:center;">		<p>No dishes yet in your list!</p>		<a type="button" class="btn btn-custom btn-lg" data-toggle="modal" data-target="#modal_adddish"><i class="fa fa-plus" aria-hidden="true"></i> Add first dish</a>	</div>{% endif %}</div>
{% endblock %}{% block extra-bottom %}<script src="{% static 'dist/jquery/autocomplete/jquery-ui.min.js' %}"></script><script>$('#modal_adddish').on('shown.bs.modal', function () {	$('#id_auto').focus()});$('#modalComment').on('shown.bs.modal', function () {	$('#id_comments').focus()});$('#modal_delete').on('shown.bs.modal', function () {	$('#modaldelete_button').focus();});$( function() {	//When a new dish is entered:	$( "#id_auto" ).autocomplete({		minLength: 3,		source: '/dish_list/',		appendTo: "#modal_adddish",		focus: function( event, ui ) {			return false;		},		//Additional intructions when new dish entered:		select: function( event, ui ) {			$("#id_auto").val("");			//Retrieving information from the dish selected			$.ajax({				type: 'GET',				url: '/ajax_getdish/',				dataType:'json',				async: true,				data: {					'id':ui.item.value					},				success: searchSuccess			});		return false;		},	});});function searchSuccess(json){	//# function executed when user selects dish from autocomplete	//# receives json object with dish information. Ask if info comming:	if (json != 0){		//# There is dish information. Populate Modal with dish info		//# Create cuisines string from json object		var cuisines = '';		for (i in json.cuisines) {			//# Created a sting with all dish cuisines			cuisines += "("+json.cuisines[i]+")";		};		//# Displays par of modal with dish information		$('#modal_dish').css('display','block');		$('#modal_select').css('visibility', 'visible');		$('#modal_dishname').html(json.name);		if (cuisines != ""){			$('#modal_cuisines').html(cuisines);		};		if (json.othernames != ""){			$('#modal-othernames').html(json.othernames);		};		if (json.favphoto != "0"){			$('#modal-image').attr('src', json.favphoto);		}		else{			$('#modal-image').attr('src', "/media/images/upload-med.jpg");			};		if (json.description != "0"){			$('#modal-dishdescription').html(json.description.substring(0, 300));		};		//# Check if dish already exist in list:		if (document.getElementById(json.urlname)) {			//# Dish already in list			$('#myAlert').show(); //# Shows alert			$("#myAlert").addClass("in"); //# alert fades in? check!			$('#modal_select').addClass('disabled'); //# Disable button "Add dish"		}		else{			//# Dish selected is not in the list:			$('#myAlert').hide(); //# Hide "dish already in list" alert			$('#modal_select').removeClass('disabled'); //# Enable button "Add dish"			//# generate url for "Add dish" button:			var path = window.location.href; // #Whole path			var url_name = json.id;			var to_delete = "/listeditowner/{{list.urlname}}";			var main_path = path.replace(to_delete,'');			var url_delete = main_path+"list_add_dish/"+{{list.id}}+"/"+json.id+"/listeditowner";			$('#modal_select').attr("href",url_delete);			$('#modal_select').focus();		}	};}$('#modal_cancel').click(function(){	//Button cancel del modal pressed, clear modal from current dish	$('#modal-dishdescription').html("");	$('#modal_dish').css('display','none');});$('#modal_adddish').on('hidden.bs.modal', function () {	//When modal desapears when click outside modal	$('#modal_dish').css('display','none');	$('#modal_select').css('visibility', 'hidden');	$('#modal_select').removeClass('disabled'); //# Enable button "Add dish"	$('#myAlert').hide();	$("#id_auto").val(""); //# Clears autocomplete input});$('#modal_delete').click(function(){	//Funtion activated when x pressed in dish to be deleted from list	$('#modal-dishdescription').html("");	$('#modal_dish').css('display','none');});$( "a[name^='delete_']" ).click(function() {	var dish_id = $(this).attr('id');	var dishname = $('#dishname_'+dish_id+'').html();	var othernames = $('#othernames_'+dish_id+'').html();	var cuisines = $('#cuisines_'+dish_id+'').html();	var description = $('#description_'+dish_id+'').html();	var urlimage = $('#url_'+dish_id+'').attr('src');	//# builing url for delete button:	var path = window.location.href; // #Whole path	var to_delete = "/listeditowner/{{list.urlname}}";	var main_path = path.replace(to_delete,'');	var delete_path = main_path+"list_delete_dish/"+{{list.id}}+"/"+dish_id;	$('#modaldelete_dishname').html(dishname);	$('#modaldelete_othernames').html(othernames);	$('#modaldelete_cuisines').html(cuisines);	$('#modaldelete_description').html(description);	$('#modaldelete_image').attr('src',urlimage);	$('#modaldelete_button').attr("href",delete_path);	$('#modal_delete').modal('show');});{# shows all text when butten more pressed #}$("a[id^='more_']").on("click", function () {	var index_ = $(this).attr('id');	var index = index_.replace('more_','')	var query = $('#big_'+index);	var isVisible = query.is(':visible');	if (isVisible == false){		//alert('Big not showing, show it');		$('#big_'+index).css({display:'block'});		$('#small_'+index).css({display:'none'});		$('#more_'+index).text('less');	  }	 else{		//alert('Big showing, hide it');		$('#big_'+index).css({display:'none'});		$('#small_'+index).css({display:'block'});		$('#more_'+index).text('more');	};});$('#modal_delete').on('hidden.bs.modal', function () {	//When modal desapears when click outside modal	// Clear elements so they don't show next time when new	// info doesn't come lile (othernames, cusines)	$('#modaldelete_description').html("");	$('#modaldelete_othernames').html("");	$('#modaldelete_cuisines').html("");	$('#modaldelete_image').attr('src',"");});// #Add comments to dishes:$( "a[id^='comment_']" ).click(function(){	var index = $(this).attr('name');	var comment = $('#comment_whole_'+index).text();	comment_id = $(this).attr('id')	$("#id_comments").val(comment.trim());	// <1> Get dish name for title:	var dishname = $('#dishnamecomment_'+index).text();	$('#modalcomment_dishname').html(dishname); 	//<1-end>	//alert(comment);	$("#id_list_dish").val(comment_id.replace('comment_',''));	$("#modalComment").modal('show');});//function to show the modal "Processing" when loading results pagefunction processing(){	$("#modal_adddish").modal('hide');	$("#modal_delete").modal('hide');	$("#modal_processing").modal('show');}</script>{% endblock %}